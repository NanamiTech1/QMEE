<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="qmee.css" type="text/css" />
</head>
<body>
<header class="site-header">
<div class="wrapper">
	<h1 class="title">
		<a href="index.html">Biology 708, McMaster University</a>
	</h1>
	<div style="text-align:center">
		<img src="http://imgs.xkcd.com/comics/self_description.png">
	</div>
</div>
</header>
<p>ggplot example ========================================================</p>
<p>```{r opts,echo=FALSE} opts_chunk$set(message=FALSE,warning=FALSE) ## cheating ```</p>
<p>```{r pkgs} library(mlmRev) ## for contraception data library(ggplot2) library(grid) ## for unit() ```</p>
<p>```{r} theme_set(theme_bw()+theme(panel.margin=unit(0,“lines”))) ```</p>
<p>```{r} g1 &lt;- ggplot(Contraception,aes(x=age,y=use))+</p>
<p><code> labs(x=&quot;Centered age&quot;,y=&quot;Contraceptive use&quot;)</code></p>
<p>print(g1+geom_point()) ```</p>
<p>Not very useful!</p>
<p>Use a fancy component (`stat_sum`) that calculates the proportion of the data in a given category that fall at exactly the same $\{x,y\}$ location, and by default changes the size of the symbol proportionally: ```{r} print(g1+stat_sum()) ```</p>
<p>Use transparency – not a mapping (which would be inside an `aes()` function) but a hard-coded value: ```{r} print(g1+stat_sum(alpha=0.25)) ```</p>
<p>Distinguish by number of live children: ```{r} g2 &lt;- ggplot(Contraception,aes(x=age,y=use,colour=livch))+</p>
<p><code>   labs(x=&quot;Centered age&quot;,y=&quot;Contraceptive use&quot;)</code></p>
<p>g3 &lt;- g2+stat_sum(alpha=0.25) print(g3) ```</p>
<p>Add smooth lines: ```{r} print(g4 &lt;- g3 + geom_smooth(aes(y=as.numeric(use)))) ```</p>
<p>Adjust the axis limits. ```{r} print(g4 &lt;- g3 + geom_smooth(aes(y=as.numeric(use)))+</p>
<p><code>       coord_cartesian(ylim=c(0.9,2.1)))</code></p>
<p>``` Technical details:</p>
<ul>
<li>we need to know that the numeric values on the $y$ axis actually correspond to the underlying **numeric** factor codes (N=1,Y=2);</li>
<li>we use `coord_cartesian(ylim=…)` rather than just saying `+ylim(0.9,2.1)`, which will erase the confidence-interval ribbons that go below the lower limits of the graph</li>
</ul>
<p>Facet by urban/rural: the syntax is `rows~columns`, and `.` here means “nothing”, or “only a single row” (cf. `facet_wrap`) ```{r} g4+facet_grid(.~urban) ```</p>
<p>Separate urban/rural by line type instead (and turn off confidence-interval ribbons): ```{r} g3 + geom_smooth(aes(y=as.numeric(use),</p>
<p><code>                           lty=urban),se=FALSE)</code></p>
<p>```</p>
<ul>
<li>Technical detail: we need `as.numeric(use)` because `use` is a factor.</li>
</ul>
<p>Or make the confidence-interval ribbons light (`alpha=0.1`) instead of turning them off completely: ```{r} g3 + geom_smooth(aes(y=as.numeric(use),</p>
<p><code>                    lty=urban),alpha=0.1)</code></p>
<p>```</p>
<p>Advanced topic: smooth by fitting a polynomial logistic regression. ```{r} g5 &lt;- ggplot(Contraception,aes(x=age,</p>
<p><code>                              y=as.numeric(use)-1,</code><br />
<code>                              colour=livch))+</code><br />
<code> stat_sum(alpha=0.25)+labs(x=&quot;Centered age&quot;,y=&quot;Contraceptive use&quot;)</code></p>
<p>g5 + geom_smooth(aes(lty=urban),method=“glm”,</p>
<p><code>                    family=&quot;binomial&quot;,</code><br />
<code>                    formula=y~poly(x,2),alpha=0.1)</code></p>
<p>``` Technical details:</p>
<ul>
<li>have to convert $y$ from (1,2) to (0,1) so that logistic regression makes sense</li>
</ul>
<p>A more common use would be to use `method=“lm”` to get linear regression lines for each group.</p>
<p>Two-way faceting: ```{r} g1 + facet_grid(livch~urban)+geom_smooth(aes(y=as.numeric(use))) ``` This is nice, although a plot without data is always a little scary.</source-file></p>
<div id="footer">
	<div style="text-align:center">
		<a href="index.html">Course home page</a>
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
		<a href="mailto:bio708qmee@gmail.com">Email the profs</a>
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
		<a href="logo.html">Logo information</a>
	</div>
</div>
</body>
</html>
