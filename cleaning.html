<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Jonathan Dushoff" />
  <title>Clean and tidy data</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="qmee.css" type="text/css" />
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
</head>
<body>
<header class="site-header">
<div class="wrapper">
	<h1 class="title">
		<a href="index.html">Biology 708, McMaster University</a>
	</h1>
	<div style="text-align:center">
		<img src="http://imgs.xkcd.com/comics/self_description.png">
	</div>
</div>
</header>
<div id="header">
<h1 class="title">Clean and tidy data</h1>
<h2 class="author">Jonathan Dushoff</h2>
<h3 class="date">MMED 2017</h3>
</div>
<h2 id="data-analysis">Data analysis</h2>
<p>Data must be:</p>
<ul>
<li><p>Organized</p></li>
<li><p>Cleaned</p></li>
<li><p>Manipulated</p></li>
<li><p>Analyzed</p></li>
</ul>
<p>The first three often take the most time, and this is often because researchers undervalue them.</p>
<p>There’s never time to do it right … but there’s always time to do it over!</p>
<h2 id="structured-tools-for-dealing-with-data">Structured tools for dealing with data</h2>
<ul>
<li>dplyr</li>
<li>tidyr</li>
<li>readr</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr</code></pre>
<pre><code>## Conflicts with tidy packages ----------------------------------------------</code></pre>
<pre><code>## filter(): dplyr, stats
## lag():    dplyr, stats</code></pre>
<h2 id="a-sample-data-set">A sample data set</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">villageTable &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;~/git/Malaria/village.csv&quot;</span>)
<span class="kw">summary</span>(villageTable)</code></pre></div>
<pre><code>##       area       village           grid          fup        
##  A1     : 8   Min.   :  1.0   4C     :  7   Min.   : 1.000  
##  A2     :62   1st Qu.:211.2   7C     :  7   1st Qu.: 3.000  
##  B      :85   Median :362.5   8E     :  7   Median : 6.000  
##  Babura : 1   Mean   :402.0   4B     :  6   Mean   : 6.217  
##  Banzoma: 5   3rd Qu.:565.2   4D     :  6   3rd Qu.: 7.000  
##  C      : 5   Max.   :967.0   6B     :  6   Max.   :92.000  
##  Ringim :14                   (Other):141                   
##             vname           vu        grouped1         grouped2      
##  Daurawa       :  2   Kar    :26   Min.   :  0.00   Min.   : 0.0000  
##  Sabon Gari    :  2   Dok    :21   1st Qu.:  0.00   1st Qu.: 0.0000  
##  Adinis Fulanin:  1   Kit    :18   Median : 24.50   Median : 0.0000  
##  Aduwa         :  1   Aju    :13   Mean   : 37.06   Mean   : 0.7833  
##  Ajura         :  1   Gar    :13   3rd Qu.: 52.25   3rd Qu.: 1.0000  
##  Anju          :  1   Sug    :13   Max.   :550.00   Max.   :10.0000  
##  (Other)       :172   (Other):76                                     
##    scattered1       scattered2        population    
##  Min.   :  0.00   Min.   :0.00000   Min.   :   0.0  
##  1st Qu.:  0.00   1st Qu.:0.00000   1st Qu.: 124.0  
##  Median :  6.00   Median :0.00000   Median : 222.0  
##  Mean   : 14.29   Mean   :0.01111   Mean   : 287.1  
##  3rd Qu.: 22.00   3rd Qu.:0.00000   3rd Qu.: 375.0  
##  Max.   :117.00   Max.   :1.00000   Max.   :2556.0  
## </code></pre>
<h2 id="a-sample-data-set-1">A sample data set</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">parasiteTable &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;~/git/Malaria/parademo.csv&quot;</span>)
<span class="kw">summary</span>(parasiteTable)</code></pre></div>
<pre><code>##        id           village         compound       survey     
##  Min.   :    1   Min.   : 51.0   Min.   :  1   Min.   : 1.00  
##  1st Qu.: 2671   1st Qu.:202.0   1st Qu.: 40   1st Qu.: 6.00  
##  Median : 6186   Median :220.0   Median :205   Median :10.00  
##  Mean   : 5980   Mean   :337.3   Mean   :176   Mean   :10.61  
##  3rd Qu.: 8993   3rd Qu.:552.0   3rd Qu.:249   3rd Qu.:15.00  
##  Max.   :12849   Max.   :806.0   Max.   :949   Max.   :23.00  
##                                                               
##      person            sch            X_add           tribe        
##  Min.   : 1.000   Min.   :0.000   Min.   :1.000   Min.   :0.00000  
##  1st Qu.: 2.000   1st Qu.:1.000   1st Qu.:2.000   1st Qu.:0.00000  
##  Median : 5.000   Median :1.000   Median :2.000   Median :0.00000  
##  Mean   : 6.745   Mean   :1.189   Mean   :1.906   Mean   :0.08756  
##  3rd Qu.: 9.000   3rd Qu.:1.000   3rd Qu.:2.000   3rd Qu.:0.00000  
##  Max.   :99.000   Max.   :5.000   Max.   :2.000   Max.   :3.00000  
##                                                                    
##       hght            sleep             dist               baby      
##  Min.   :  0.00   Min.   :0.0000   Min.   :0.00e+00   Min.   :0.000  
##  1st Qu.:  0.00   1st Qu.:1.0000   1st Qu.:0.00e+00   1st Qu.:2.000  
##  Median :  0.00   Median :1.0000   Median :0.00e+00   Median :2.000  
##  Mean   : 15.33   Mean   :0.7863   Mean   :7.96e-05   Mean   :1.714  
##  3rd Qu.:  0.00   3rd Qu.:1.0000   3rd Qu.:0.00e+00   3rd Qu.:2.000  
##  Max.   :985.00   Max.   :2.0000   Max.   :2.00e+00   Max.   :2.000  
##                                                                      
##      alive                datecoll           coll         
##  Min.   :0.000000   1973-12-20:   464   Min.   :       0  
##  1st Qu.:0.000000   1972-12-27:   383   1st Qu.:       1  
##  Median :0.000000   1974-08-01:   375   Median :       1  
##  Mean   :0.005442   1972-05-03:   355   Mean   :     138  
##  3rd Qu.:0.000000   1973-12-31:   346   3rd Qu.:       1  
##  Max.   :2.000000   1973-04-27:   337   Max.   :19000000  
##                     (Other)   :135937                     
##      sliden            car1           ncar1               car2      
##  Min.   :     0   Min.   :0.000   Min.   :    0.00   Min.   :0.000  
##  1st Qu.: 14967   1st Qu.:1.000   1st Qu.:    0.00   1st Qu.:1.000  
##  Median : 47182   Median :3.000   Median :    0.00   Median :3.000  
##  Mean   : 49504   Mean   :2.263   Mean   :   85.08   Mean   :2.298  
##  3rd Qu.: 81473   3rd Qu.:3.000   3rd Qu.:    0.00   3rd Qu.:3.000  
##  Max.   :117927   Max.   :3.000   Max.   :30000.00   Max.   :3.000  
##                                                                     
##      ncar2               filt           nfilt             fever      
##  Min.   :   0.000   Min.   :0.000   Min.   :0.0e+00   Min.   :0.000  
##  1st Qu.:   0.000   1st Qu.:1.000   1st Qu.:0.0e+00   1st Qu.:2.000  
##  Median :   0.000   Median :3.000   Median :0.0e+00   Median :2.000  
##  Mean   :   1.888   Mean   :2.279   Mean   :7.3e-02   Mean   :1.694  
##  3rd Qu.:   0.000   3rd Qu.:3.000   3rd Qu.:0.0e+00   3rd Qu.:2.000  
##  Max.   :4200.000   Max.   :3.000   Max.   :1.0e+04   Max.   :2.000  
##                                                                      
##         datep            micro              dateexam         slide       
##  0000-00-00: 19703   Min.   : 0.000   0000-00-00:38403   Min.   :     0  
##  1973-12-20:   410   1st Qu.: 5.000   1972-08-22:  261   1st Qu.: 14967  
##  1974-08-01:   344   Median : 7.000   1973-03-08:  255   Median : 47182  
##  1972-05-03:   306   Mean   : 7.226   1972-01-11:  250   Mean   : 49504  
##  1973-05-22:   303   3rd Qu.:10.000   1973-03-06:  249   3rd Qu.: 81473  
##  1972-07-27:   282   Max.   :90.000   1972-08-21:  247   Max.   :117927  
##  (Other)   :116849                    (Other)   :98532                   
##       exam            pfa              pfg                 pm         
##  Min.   :  0.0   Min.   :  0.00   Min.   :  0.0000   Min.   :  0.000  
##  1st Qu.:200.0   1st Qu.:  0.00   1st Qu.:  0.0000   1st Qu.:  0.000  
##  Median :200.0   Median :  0.00   Median :  0.0000   Median :  0.000  
##  Mean   :198.3   Mean   : 16.05   Mean   :  0.5428   Mean   :  1.442  
##  3rd Qu.:200.0   3rd Qu.:  3.00   3rd Qu.:  0.0000   3rd Qu.:  0.000  
##  Max.   :462.0   Max.   :449.00   Max.   :392.0000   Max.   :400.000  
##                                                                       
##        po                ppfa             ppfg              ppm         
##  Min.   :  0.0000   Min.   :0.0000   Min.   :0.00000   Min.   :0.00000  
##  1st Qu.:  0.0000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.00000  
##  Median :  0.0000   Median :0.0000   Median :0.00000   Median :0.00000  
##  Mean   :  0.1589   Mean   :0.2982   Mean   :0.08759   Mean   :0.09235  
##  3rd Qu.:  0.0000   3rd Qu.:1.0000   3rd Qu.:0.00000   3rd Qu.:0.00000  
##  Max.   :396.0000   Max.   :1.0000   Max.   :1.00000   Max.   :1.00000  
##                                                                         
##       ppo                 pf             smove              agec        
##  Min.   :0.000000   Min.   :  0.00   Min.   :0.00000   Min.   :0.00000  
##  1st Qu.:0.000000   1st Qu.:  0.00   1st Qu.:0.00000   1st Qu.:0.00000  
##  Median :0.000000   Median :  0.00   Median :0.00000   Median :0.00000  
##  Mean   :0.009935   Mean   : 16.38   Mean   :0.00657   Mean   :0.00419  
##  3rd Qu.:0.000000   3rd Qu.:  3.00   3rd Qu.:0.00000   3rd Qu.:0.00000  
##  Max.   :1.000000   Max.   :449.00   Max.   :1.00000   Max.   :7.00000  
## </code></pre>
<h2 id="entering-maintaining-and-using-data">Entering, maintaining and using data</h2>
<ul>
<li><p>These are different functions, and often call for different ways of formatting data</p></li>
<li><p>This is why we have computers</p></li>
</ul>
<h2 id="data-entry">Data entry</h2>
<ul>
<li><p>Convenient for users</p></li>
<li><p>Some amount of redundancy is good (to catch errors)</p></li>
<li><p>Often a “wide” format (related information on the same row)</p></li>
</ul>
<h2 id="data-use">Data use</h2>
<ul>
<li><p>Scanning for patterns and problems</p></li>
<li><p>Making tables for publication</p></li>
<li><p>Making data frames for statistical analysis</p></li>
</ul>
<h2 id="data-maintenance">Data maintenance</h2>
<ul>
<li>Your database is
<ul>
<li>a logical construct</li>
<li>maybe also a real thing</li>
</ul></li>
<li>Data in the database is:
<ul>
<li>Non-redundant</li>
<li>Relational</li>
<li>“Long”</li>
</ul></li>
</ul>
<h2 id="redundancy">Redundancy</h2>
<p>You don’t want any redundancy in your database (although you might in your data set)</p>
<ul>
<li><p>Removing redundancies is a great way to check data integrity</p></li>
<li>Non-redundant information can be updated conveniently
<ul>
<li>and without introducing new errors</li>
</ul></li>
</ul>
<h2 id="example">Example</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(parasiteTable)</code></pre></div>
<pre><code>##   id village compound survey person sch X_add tribe hght sleep dist baby
## 1  1     801      401      1      1   1     1     1    0     1    0    2
## 2  1     801      401      2      1   1     2     0    0     1    0    2
## 3  1     801      401      3      1   1     2     0    0     1    0    2
## 4  1     801      401      4      1   1     2     0    0     1    0    2
## 5  1     801      401      5      1   1     2     0    0     1    0    2
## 6  1     801      401      6      1   1     2     0    0     1    0    2
##   alive   datecoll coll sliden car1 ncar1 car2 ncar2 filt nfilt fever
## 1     0 1970-11-19    1   2099    3     0    3     0    3     0     1
## 2     0 1971-02-08    1   7048    3     0    3     0    3     0     2
## 3     0 1971-04-16    1  10878    3     0    3     0    3     0     2
## 4     0 1971-06-29    1  17718    3     0    3     0    3     0     2
## 5     0 1971-09-07    1  22696    3     0    3     0    3     0     2
## 6     0 1971-11-30    1  36018    3     0    3     0    3     0     2
##        datep micro   dateexam slide exam pfa pfg pm po ppfa ppfg ppm ppo
## 1 1970-11-19     2 1970-12-19  2099  201   2   0  0  0    1    0   0   0
## 2 1971-02-08     5 1971-03-17  7048  200   0   0  0  0    0    0   0   0
## 3 1971-04-16     2 1971-05-17 10878  200   0   0  0  0    0    0   0   0
## 4 1971-06-29    11 1971-07-14 17718  200   0   0  3  0    0    0   1   0
## 5 1971-09-07     1 1971-09-10 22696  200   0   0  0  0    0    0   0   0
## 6 1971-11-30    10 1971-12-03 36018  200   0   0  0  2    0    0   0   1
##   pf smove agec
## 1  2     0    0
## 2  0     0    0
## 3  0     0    0
## 4  0     0    0
## 5  0     0    0
## 6  0     0    0</code></pre>
<h2 id="tidy-data">Tidy data</h2>
<ul>
<li><p>No redundancy</p></li>
<li><p>Break data into separate tables following the logic of the data</p></li>
<li><p>Clear “keys” to describe the information in each row</p></li>
</ul>
<h2 id="relational">Relational</h2>
<p>Break data into logical tables</p>
<ul>
<li>Information at the level where it belongs:
<ul>
<li>Sampling event</li>
<li>Individual</li>
<li>Household</li>
<li>Village</li>
<li>Village group</li>
</ul></li>
</ul>
<h2 id="tidy">Tidy</h2>
<ul>
<li>Use long structure to mark things that are comparable, or have the same units
<ul>
<li>SIR example</li>
</ul></li>
</ul>
<h2 id="flow">Flow</h2>
<ul>
<li>Put input data into a tidy, relational form
<ul>
<li>Clean on the way</li>
<li>This is your database, whether you use database software or not</li>
</ul></li>
<li><p>Clean, maintain and merge data in the database</p></li>
<li><p>Export files for analysis, presentation, etc.</p></li>
</ul>
<h1 id="importing">Importing</h1>
<h2 id="summarize">Summarize</h2>
<ul>
<li>Check that numbers are numbers, dates are dates, etc.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">villageTable &lt;-<span class="st"> </span>(villageTable
    %&gt;%<span class="st"> </span><span class="kw">transform</span>(<span class="dt">village=</span><span class="kw">as.factor</span>(village))
)
<span class="kw">summary</span>(villageTable)</code></pre></div>
<pre><code>##       area       village         grid          fup        
##  A1     : 8   1      :  1   4C     :  7   Min.   : 1.000  
##  A2     :62   2      :  1   7C     :  7   1st Qu.: 3.000  
##  B      :85   3      :  1   8E     :  7   Median : 6.000  
##  Babura : 1   4      :  1   4B     :  6   Mean   : 6.217  
##  Banzoma: 5   5      :  1   4D     :  6   3rd Qu.: 7.000  
##  C      : 5   6      :  1   6B     :  6   Max.   :92.000  
##  Ringim :14   (Other):174   (Other):141                   
##             vname           vu        grouped1         grouped2      
##  Daurawa       :  2   Kar    :26   Min.   :  0.00   Min.   : 0.0000  
##  Sabon Gari    :  2   Dok    :21   1st Qu.:  0.00   1st Qu.: 0.0000  
##  Adinis Fulanin:  1   Kit    :18   Median : 24.50   Median : 0.0000  
##  Aduwa         :  1   Aju    :13   Mean   : 37.06   Mean   : 0.7833  
##  Ajura         :  1   Gar    :13   3rd Qu.: 52.25   3rd Qu.: 1.0000  
##  Anju          :  1   Sug    :13   Max.   :550.00   Max.   :10.0000  
##  (Other)       :172   (Other):76                                     
##    scattered1       scattered2        population    
##  Min.   :  0.00   Min.   :0.00000   Min.   :   0.0  
##  1st Qu.:  0.00   1st Qu.:0.00000   1st Qu.: 124.0  
##  Median :  6.00   Median :0.00000   Median : 222.0  
##  Mean   : 14.29   Mean   :0.01111   Mean   : 287.1  
##  3rd Qu.: 22.00   3rd Qu.:0.00000   3rd Qu.: 375.0  
##  Max.   :117.00   Max.   :1.00000   Max.   :2556.0  
## </code></pre>
<h2 id="list">List</h2>
<ul>
<li>Make lists of what occurs with what (and how many times)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(villageTable
    %&gt;%<span class="st"> </span><span class="kw">group_by</span>(vname, vu)
    %&gt;%<span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>())
)</code></pre></div>
<pre><code>## Source: local data frame [180 x 3]
## Groups: vname [?]
## 
##              vname     vu count
##             &lt;fctr&gt; &lt;fctr&gt; &lt;int&gt;
## 1   Adinis Fulanin    Kar     1
## 2            Aduwa    Aju     1
## 3            Ajura    Aju     1
## 4             Anju    Dok     1
## 5           Arindi    Sug     1
## 6          Asayaya    Kit     1
## 7            Ba&#39;wa    Dok     1
## 8     Bakan Sabara    Kar     1
## 9  Bakan Sabara II    Kar     1
## 10       Balalashi    Dok     1
## # ... with 170 more rows</code></pre>
<h2 id="section">…</h2>
<ul>
<li>The computer is your friend</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(villageTable
    %&gt;%<span class="st"> </span><span class="kw">group_by</span>(vname, vu)
    %&gt;%<span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>())
    %&gt;%<span class="st"> </span><span class="kw">filter</span>(count&gt;<span class="dv">1</span>)
)</code></pre></div>
<pre><code>## Source: local data frame [0 x 3]
## Groups: vname [0]
## 
## # ... with 3 variables: vname &lt;fctr&gt;, vu &lt;fctr&gt;, count &lt;int&gt;</code></pre>
<h2 id="section-1">…</h2>
<ul>
<li>and you always want to check yourself</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(villageTable
    %&gt;%<span class="st"> </span><span class="kw">group_by</span>(vname)
    %&gt;%<span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>())
    %&gt;%<span class="st"> </span><span class="kw">filter</span>(count&gt;<span class="dv">1</span>)
)</code></pre></div>
<pre><code>## # A tibble: 2 × 2
##        vname count
##       &lt;fctr&gt; &lt;int&gt;
## 1    Daurawa     2
## 2 Sabon Gari     2</code></pre>
<h2 id="making-a-relational-table">Making a relational table</h2>
<p>If we had data like the parasite Table, we would want to break it into</p>
<ul>
<li><p>A table at the level of people</p></li>
<li><p>A table at the level of sampling events</p></li>
<li><p>A table at the level of measurements</p></li>
</ul>
<p>This process leads to improved clarity, _and improved cleaning__</p>
<h2 id="parasite-table">Parasite table</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(parasiteTable
    %&gt;%<span class="st"> </span><span class="kw">group_by</span>(id, village, compound)
    %&gt;%<span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count=</span><span class="kw">n</span>())
)</code></pre></div>
<pre><code>## Source: local data frame [13,656 x 4]
## Groups: id, village [?]
## 
##       id village compound count
##    &lt;int&gt;   &lt;int&gt;    &lt;int&gt; &lt;int&gt;
## 1      1     801      401    16
## 2      2     801      401    16
## 3      3     801      401    16
## 4      4     801      401    16
## 5      5     801      401    16
## 6      6     801      401    16
## 7      7     801      401    12
## 8      8     801      401    11
## 9      9     801      401    15
## 10     9     801      417     1
## # ... with 13,646 more rows</code></pre>
<h2 id="parasite-table-1">Parasite table</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(parasiteTable
    %&gt;%<span class="st"> </span><span class="kw">group_by</span>(id, village, compound)
    %&gt;%<span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count=</span><span class="kw">n</span>())
    %&gt;%<span class="st"> </span><span class="kw">group_by</span>(id)
    %&gt;%<span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count=</span><span class="kw">n</span>())
    %&gt;%<span class="st"> </span><span class="kw">filter</span>(count&gt;<span class="dv">1</span>)
)</code></pre></div>
<pre><code>## # A tibble: 756 × 2
##       id count
##    &lt;int&gt; &lt;int&gt;
## 1      9     2
## 2     25     2
## 3     40     2
## 4     41     3
## 5     51     2
## 6     52     2
## 7     90     2
## 8    112     2
## 9    125     2
## 10   126     2
## # ... with 746 more rows</code></pre>
<h2 id="explore-ranges">Explore ranges</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">ggplot</span>(villageTable, <span class="kw">aes</span>(<span class="dt">x=</span>population))
    +<span class="st"> </span><span class="kw">geom_histogram</span>()
)</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="figure/pophist.R-1.png" alt="plot of chunk pophist.R" /> <img src="figure/pophist-1.png" alt="Population histogram" /></p>
<h1 id="correction-tables">Correction tables</h1>
<h2 id="mistakes">Mistakes</h2>
<p>Let’s say you find an obvious error in your data</p>
<pre><code>##   country continent count
## 1   Kenya    Africa    23
## 2  Uganda    Africa    31
## 3  Ungada    Africa     1
## 4 Vietnam      Asia    16</code></pre>
<p>How should you fix it?</p>
<h2 id="a-table">A table</h2>
<p>A table:</p>
<ul>
<li>respects the original data</li>
<li>records your decision</li>
<li>is transparent to yourself and others</li>
<li><strong>fixes the mistake again, if it happens again</strong></li>
</ul>
<pre><code>##   country patchcountry
## 1  Ungada       Uganda</code></pre>
<h2 id="awkward-example">Awkward example</h2>
<ul>
<li><p>We should fix the real table, not the summary table</p></li>
<li><p>But I don’t have access to the real table in this case</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patchtab &lt;-<span class="st"> </span>(ctab
    %&gt;%<span class="st"> </span><span class="kw">left_join</span>(cortab)
)</code></pre></div>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning in left_join_impl(x, y, by$x, by$y, suffix$x, suffix$y): joining
## factors with different levels, coercing to character vector</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(patchtab)</code></pre></div>
<pre><code>##   country continent count patchcountry
## 1   Kenya    Africa    23         &lt;NA&gt;
## 2  Uganda    Africa    31         &lt;NA&gt;
## 3  Ungada    Africa     1       Uganda
## 4 Vietnam      Asia    16         &lt;NA&gt;</code></pre>
<h2 id="na-logic-is-scary">NA logic is scary</h2>
<p>NA means “Something I don’t know”. You don’t get the answers you expect if you compare things to NA:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">&quot;Jonathan&quot;</span> ==<span class="st"> </span><span class="ot">NA</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<h2 id="finish-the-patch-being-careful">Finish the patch, being careful</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctab &lt;-<span class="st"> </span>(patchtab
    %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">country=</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(patchcountry), country, patchcountry))
    %&gt;%<span class="st"> </span><span class="kw">select</span>(-patchcountry)
)
<span class="kw">print</span>(ctab)</code></pre></div>
<pre><code>##   country continent count
## 1   Kenya    Africa    23
## 2  Uganda    Africa    31
## 3       1    Africa     1
## 4 Vietnam      Asia    16</code></pre>
<h2 id="be-careful-er">Be careful-er</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctab &lt;-<span class="st"> </span>(patchtab
    %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">country=</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(patchcountry), country, 
        <span class="kw">as.character</span>(patchcountry)))
    %&gt;%<span class="st"> </span><span class="kw">select</span>(-patchcountry)
)
<span class="kw">print</span>(ctab)</code></pre></div>
<pre><code>##   country continent count
## 1   Kenya    Africa    23
## 2  Uganda    Africa    31
## 3  Uganda    Africa     1
## 4 Vietnam      Asia    16</code></pre>
<ul>
<li>Never be afraid to break pipes up or put them back together.</li>
</ul>
<h2 id="factors">Factors</h2>
<ul>
<li><p>R likes to convert characters to factors</p></li>
<li><p>Factors can be useful, but they’re more often weird</p></li>
<li><p>Be aware of this as a possible problem</p></li>
<li><p>The more you use tools the tidy family, the less this will happen</p></li>
</ul>
<h2 id="dictionary-tables">Dictionary tables</h2>
<ul>
<li><p>You might want to summarize a factor variable into categories that you define</p></li>
<li>In this case you could use a similar table (Ungada <span class="math inline">\(\to\)</span> Uganda), but different logic
<ul>
<li>You only want to keep the new version</li>
<li>… and check for cases where the original is not matched</li>
</ul></li>
</ul>
<h2 id="making-dictionaries">Making dictionaries</h2>
<p>Print out all the for a variable, and see what you think of them</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(survey
    %&gt;%<span class="st"> </span><span class="kw">select</span>(code)
    %&gt;%<span class="st"> </span><span class="kw">distinct</span>()
)</code></pre></div>
<pre><code>##                           code
## 1                     Catholic
## 2                     Orthodox
## 3               Roman catholic
## 4                    Adventist
## 5                     Anglican
## 6              Anglican Church
## 7               Apostolic Sect
## 8                     Aventist
## 9                         CCAP
## 10                 Charismatic
## 11                  Christrian
## 12                  Chrétienne
## 13           Eglise du 7e jour
## 14                       Elcin
## 15                   Envagelic
## 16                  Evangelist
## 17                 Evangelical
## 18                  ^Christian
## 19                     Jehovah
## 20             Jehovah Witness
## 21                 kimbanguist
## 22                   Methodist
## 23               New apostolic
## 24                 Pentecostal
## 25                  Protestant
## 26         Protestant/Anglican
## 27 Protestant/ other Christian
## 28              Salvation Army
## 29                 Seventh Day
## 30       Seventh-day adventist
## 31                         SDA
## 32                     Baptist
## 33                       ^Zion
## 34                     Zionist
## 35                       Islam
## 36                     Islamic
## 37                      Moslem
## 38                      Muslem
## 39                      Mulsim
## 40                      Muslim
## 41                      Muslum
## 42                  Musualmane
## 43            African religion
## 44                     Animist
## 45                    Animiste
## 46             Anytime message
## 47                       Bahai
## 48                      Bisaka
## 49                       Hindu
## 50                       Jeova
## 51                        Mana
## 52                       Mungu
## 53                        None
## 54                 No religion
## 55                      ^Other
## 56               Sans religion
## 57                 Traditional
## 58                Traditionnal
## 59              Traditionalist
## 60        Traditionnal/animist
## 61                United faith
## 62               Not responded</code></pre>
<h2 id="build-a-dictionary">Build a dictionary</h2>
<p>You should start by editing the output from your previous step</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(religTab)</code></pre></div>
<pre><code>##                           code          category
## 1                     Catholic Catholic/Orthodox
## 2                     Orthodox Catholic/Orthodox
## 3               Roman catholic Catholic/Orthodox
## 4                    Adventist   Other Christian
## 5                     Anglican   Other Christian
## 6              Anglican Church   Other Christian
## 7               Apostolic Sect   Other Christian
## 8                     Aventist   Other Christian
## 9                         CCAP   Other Christian
## 10                 Charismatic   Other Christian
## 11                  Christrian   Other Christian
## 12                  Chrétienne   Other Christian
## 13           Eglise du 7e jour   Other Christian
## 14                       Elcin   Other Christian
## 15                   Envagelic   Other Christian
## 16                  Evangelist   Other Christian
## 17                 Evangelical   Other Christian
## 18                  ^Christian   Other Christian
## 19                     Jehovah   Other Christian
## 20             Jehovah Witness   Other Christian
## 21                 kimbanguist   Other Christian
## 22                   Methodist   Other Christian
## 23               New apostolic   Other Christian
## 24                 Pentecostal   Other Christian
## 25                  Protestant   Other Christian
## 26         Protestant/Anglican   Other Christian
## 27 Protestant/ other Christian   Other Christian
## 28              Salvation Army   Other Christian
## 29                 Seventh Day   Other Christian
## 30       Seventh-day adventist   Other Christian
## 31                         SDA   Other Christian
## 32                     Baptist   Other Christian
## 33                       ^Zion   Other Christian
## 34                     Zionist   Other Christian
## 35                       Islam            Muslim
## 36                     Islamic            Muslim
## 37                      Moslem            Muslim
## 38                      Muslem            Muslim
## 39                      Mulsim            Muslim
## 40                      Muslim            Muslim
## 41                      Muslum            Muslim
## 42                  Musualmane            Muslim
## 43            African religion        None/Other
## 44                     Animist        None/Other
## 45                    Animiste        None/Other
## 46             Anytime message        None/Other
## 47                       Bahai        None/Other
## 48                      Bisaka        None/Other
## 49                       Hindu        None/Other
## 50                       Jeova        None/Other
## 51                        Mana        None/Other
## 52                       Mungu        None/Other
## 53                        None        None/Other
## 54                 No religion        None/Other
## 55                      ^Other        None/Other
## 56               Sans religion        None/Other
## 57                 Traditional        None/Other
## 58                Traditionnal        None/Other
## 59              Traditionalist        None/Other
## 60        Traditionnal/animist        None/Other
## 61                United faith        None/Other
## 62               Not responded                NA</code></pre>
<div id="footer">
	<div style="text-align:center">
		<a href="index.html">Course home page</a>
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
		<a href="mailto:bio708qmee@gmail.com">Email the profs</a>
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
		<a href="logo.html">Logo information</a>
	</div>
</div>
</body>
</html>
