<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Linear model parameters</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="qmee.css" type="text/css" />
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>
<body>
<header class="site-header">
<div class="wrapper">
	<h1 class="title">
		<a href="index.html">Biology 708, McMaster University</a>
	</h1>
	<div style="text-align:center">
		<img src="http://imgs.xkcd.com/comics/self_description.png">
	</div>
</div>
</header>
<div id="header">
<h1 class="title">Linear model parameters</h1>
</div>
<h2 id="model-parameters-definitions">Model parameters: definitions</h2>
<ul>
<li>Parameters of a linear model typically characterize <em>differences</em> in means; differences per unit of change for continuous predictors, differences between groups (or between group averages) for categorical predictors</li>
<li>Interactions are <strong>differences between differences</strong></li>
</ul>
<h2 id="coding-for-categorical-predictors-contrasts">Coding for categorical predictors: contrasts</h2>
<ul>
<li>What do the parameters of a linear model mean?<br />
</li>
<li>Start with categorical variables, because they’re potentially more confusing (“intercept and slope” isn’t too hard)</li>
<li>Default R behaviour: <em>treatment contrasts</em>
<ul>
<li><span class="math inline">\(\beta_1\)</span> = expected value in baseline group (= first level of the factor variable, by default the first in alphabetical order);</li>
<li><span class="math inline">\(\beta_i\)</span> = expected difference between group <span class="math inline">\(i\)</span> and the first group.</li>
</ul></li>
</ul>
<h2 id="example">Example</h2>
<p>The previously explored ant-colony example:</p>
<p>Define data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">forest &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">10</span>)
field  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">10</span>)
ants &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">place=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;field&quot;</span>,<span class="st">&quot;forest&quot;</span>),
            <span class="kw">c</span>(<span class="kw">length</span>(field), <span class="kw">length</span>(forest))),
  <span class="dt">colonies=</span><span class="kw">c</span>(field,forest)
)
## utility function for pretty printing
pr &lt;-<span class="st"> </span>function(m) <span class="kw">printCoefmat</span>(<span class="kw">coef</span>(<span class="kw">summary</span>(m)),
                        <span class="dt">digits=</span><span class="dv">3</span>,<span class="dt">signif.stars=</span><span class="ot">FALSE</span>)</code></pre></div>
<hr />
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pr</span>(lm1 &lt;-<span class="st"> </span><span class="kw">lm</span>(colonies~place,<span class="dt">data=</span>ants))</code></pre></div>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    10.75       0.98   10.97  4.2e-06
## placeforest    -3.75       1.27   -2.96    0.018</code></pre>
<ul>
<li>The <code>(Intercept)</code> row refers to <span class="math inline">\(\beta_1\)</span>, which is the mean density in the “field” sites (“field” comes before “forest”).</li>
<li>The <code>placeforest</code> row indicates we are looking at the effect of <code>forest</code> level of the <code>place</code> variable, i.e. the difference between “forest” and “field” sites. (To know that “field” is the baseline level we must (1) remember, or look at <code>levels(ants$place)</code> or (2) notice which level is <em>missing</em> from the list of parameter estimates.)</li>
</ul>
<hr />
<p>R’s behaviour may seem annoying at first – it seems like the estimated values of the groups are what we’re really interested in – but it is really designed for testing <em>differences among groups</em>. To get the estimates per group (what SAS calls <code>LSMEANS</code>), you could:</p>
<ul>
<li>use a regression formula <code>colonies~place-1</code>, or equivalently <code>colonies~place+0</code>, to suppress the implicit intercept term:</li>
</ul>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## placefield     10.75       0.98   10.97  4.2e-06
## placeforest     7.00       0.80    8.75  2.3e-05</code></pre>
<p>When you use the <code>colonies~place-1</code> formula, the meanings of the parameters change: <span class="math inline">\(\beta_1\)</span> is the same (mean of “field”), but <span class="math inline">\(\beta_2\)</span> is ‘mean of “field”’ rather than (“(field)-(forest)”).</p>
<hr />
<ul>
<li>Use the <code>predict</code> function:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">predict</span>(lm1,<span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">place=</span><span class="kw">c</span>(<span class="st">&quot;field&quot;</span>,<span class="st">&quot;forest&quot;</span>)),
        <span class="dt">interval=</span><span class="st">&quot;confidence&quot;</span>)</code></pre></div>
<ul>
<li>Use the <code>effects</code> package:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;effects&quot;</span>)
<span class="kw">summary</span>(<span class="kw">allEffects</span>(lm1))</code></pre></div>
<ul>
<li>Use the <code>lsmeans</code> package:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;lsmeans&quot;</span>)
<span class="kw">lsmeans</span>(lm1,<span class="dt">specs=</span>~place)</code></pre></div>
<hr />
<p>Graphical summaries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">allEffects</span>(lm1))</code></pre></div>
<p><img src="figure/alleffects-1.png" title="plot of chunk alleffects" alt="plot of chunk alleffects" style="display: block; margin: auto;" /></p>
<hr />
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;dotwhisker&quot;</span>)</code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## Loading required package: gridExtra</code></pre>
<pre><code>## Loading required package: gtable</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dwplot</span>(lm0)</code></pre></div>
<p><img src="figure/dotwhisker-1.png" title="plot of chunk dotwhisker" alt="plot of chunk dotwhisker" style="display: block; margin: auto;" /></p>
<h2 id="more-than-two-levels">More than two levels</h2>
<p>Some data on lizard perching behaviour (<code>brglm</code> package; Schoener 1970 <em>Ecology</em> <strong>51</strong>:408-418). (Ignore the fact that these are proportions/GLM would be better …)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lizards &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/lizards.csv&quot;</span>)</code></pre></div>
<p>Response is number of <em>Anolis grahami</em> lizards found on perches in particular conditions.</p>
<hr />
<p><img src="figure/unnamed-chunk-2-1.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" style="display: block; margin: auto;" /></p>
<hr />
<p>Start with the <code>time</code> variable.</p>
<p>If we leave the factors alphabetical then <span class="math inline">\(\beta_1\)</span>=“early”, <span class="math inline">\(\beta_2\)</span>=“late”-“early”, <span class="math inline">\(\beta_3\)</span>=“midday”-“early”. Change the order of the levels:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lizards &lt;-<span class="st"> </span><span class="kw">mutate</span>(lizards,
        <span class="dt">time=</span><span class="kw">factor</span>(time,
            <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;early&quot;</span>,<span class="st">&quot;midday&quot;</span>,<span class="st">&quot;late&quot;</span>)))</code></pre></div>
<p>This just swaps the definitions of <span class="math inline">\(\beta_2\)</span> and <span class="math inline">\(\beta_3\)</span>.</p>
<hr />
<p>We could also use <em>sum-to-zero</em> contrasts:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pr</span>(<span class="kw">lm</span>(grahami~time,<span class="dt">data=</span>lizards,<span class="dt">contrasts=</span><span class="kw">list</span>(<span class="dt">time=</span>contr.sum)))</code></pre></div>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    19.30       3.53    5.47  2.4e-05
## time1          -1.67       4.93   -0.34     0.74
## time2          12.85       5.10    2.52     0.02</code></pre>
<p>Now the <code>(Intercept)</code> parameter is the overall mean: <code>time1</code> and <code>time2</code> are the deviations of the first (“early”) and second (“midday”) groups from the overall mean. (See also <code>car::contr.Sum</code>.)</p>
<p>There are other ways to change the contrasts (i.e., use the <code>contrasts()</code> function to change the contrasts for a particular variable permanently, or use <code>options(contrasts=c(&quot;contr.sum&quot;,&quot;contr.poly&quot;)))</code> to change the contrasts for <em>all</em> variables), but this way may be the most transparent.</p>
<hr />
<p>There are other options for contrasts such as <code>MASS::contr.sdif()</code>, which gives the successive differences between levels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;MASS&quot;</span>)
<span class="kw">pr</span>(<span class="kw">lm</span>(grahami~time,<span class="dt">data=</span>lizards,<span class="dt">contrasts=</span><span class="kw">list</span>(<span class="dt">time=</span>contr.sdif)))</code></pre></div>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    19.30       3.53    5.47  2.4e-05
## time2-1        14.52       8.74    1.66    0.112
## time3-2       -24.02       8.74   -2.75    0.012</code></pre>
<p>You might have particular contrasts in mind (e.g. “control” vs. all other treatments, then “low” vs “high” within treatments), in which case it is probably worth learning how to set contrasts. (We will talk about testing <em>all pairwise differences later</em>, when we discuss multiple comparisons. This approach is probably not as useful as it is common.)</p>
<h1 id="multiple-treatments-and-interactions">Multiple treatments and interactions</h1>
<h2 id="additive-model">Additive model</h2>
<p>Consider the <code>light</code> variable in addition to <code>time</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pr</span>(lmTL1 &lt;-<span class="st"> </span><span class="kw">lm</span>(grahami~time+light,<span class="dt">data=</span>lizards))</code></pre></div>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    27.29       5.63    4.85  0.00011
## timemidday     13.14       7.11    1.85  0.08010
## timelate       -9.50       6.85   -1.39  0.18174
## lightsunny    -19.32       5.73   -3.37  0.00321</code></pre>
<p><span class="math inline">\(\beta_1\)</span> is the intercept (“early”,“sunny”); <span class="math inline">\(\beta_2\)</span> and <span class="math inline">\(\beta_3\)</span> are the differences from the baseline level (“early”) of the <em>first</em> variable (<code>time</code>) in the <em>baseline</em> level of the other parameter(s) (<code>light</code>=“shady”); <span class="math inline">\(\beta_4\)</span> is the difference from the baseline level (“sunny”) of the <em>second</em> variable (<code>light</code>) in the <em>baseline</em> level of <code>time</code> (“early”).</p>
<h2 id="graphical-interpretation">Graphical interpretation</h2>
<pre><code>## Loading required package: grid</code></pre>
<p><img src="figure/lizardcontrasts1-1.png" title="plot of chunk lizardcontrasts1" alt="plot of chunk lizardcontrasts1" style="display: block; margin: auto;" /></p>
<h2 id="interaction-model">Interaction model</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pr</span>(lmTL2 &lt;-<span class="st"> </span><span class="kw">lm</span>(grahami~time*light,<span class="dt">data=</span>lizards))</code></pre></div>
<pre><code>##                       Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)              23.50       5.38    4.37  0.00042
## timemidday               27.75       7.60    3.65  0.00198
## timelate                -12.75       7.60   -1.68  0.11180
## lightsunny              -11.75       7.60   -1.55  0.14061
## timemidday:lightsunny   -32.83      11.19   -2.93  0.00927
## timelate:lightsunny       6.50      10.75    0.60  0.55343</code></pre>
<p>Parameters <span class="math inline">\(\beta_1\)</span> to <span class="math inline">\(\beta_4\)</span> have the same meanings as before. Now we also have <span class="math inline">\(\beta_5\)</span> and <span class="math inline">\(\beta_6\)</span>, labelled “timemidday:lightsunny” and “timelate:lightsunny”, which describe the difference between the expected mean value of these treatment combinations based on the additive model (which are <span class="math inline">\(\beta_1 + \beta_2 + \beta_4\)</span> and <span class="math inline">\(\beta_1 + \beta_3 + \beta_4\)</span> respectively) and their actual values.</p>
<h2 id="graphical-version">Graphical version</h2>
<p><img src="figure/lizardcontrasts2-1.png" title="plot of chunk lizardcontrasts2" alt="plot of chunk lizardcontrasts2" style="display: block; margin: auto;" /></p>
<h2 id="sum-to-zero-contrasts">Sum-to-zero contrasts</h2>
<p>The fits are easy:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pr</span>(lmTL1S &lt;-<span class="st"> </span><span class="kw">update</span>(lmTL1,<span class="dt">contrasts=</span><span class="kw">list</span>(<span class="dt">time=</span>contr.sum,<span class="dt">light=</span>contr.sum)))</code></pre></div>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    18.84       2.87    6.57  2.7e-06
## time1          -1.21       4.01   -0.30   0.7654
## time2          11.92       4.15    2.87   0.0097
## light1          9.66       2.87    3.37   0.0032</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pr</span>(lmTL2S &lt;-<span class="st"> </span><span class="kw">update</span>(lmTL2,<span class="dt">contrasts=</span><span class="kw">list</span>(<span class="dt">time=</span>contr.sum,<span class="dt">light=</span>contr.sum)))</code></pre></div>
<pre><code>##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    18.236      2.255    8.09  3.1e-07
## time1          -0.611      3.146   -0.19  0.84830
## time2          10.722      3.271    3.28  0.00444
## light1         10.264      2.255    4.55  0.00028
## time1:light1   -4.389      3.146   -1.39  0.18100
## time2:light1   12.028      3.271    3.68  0.00187</code></pre>
<p>(The intercept doesn’t stay exactly the same when we add the interaction because the data are unbalanced: try <code>with(lizards,table(light,time))</code>)</p>
<p>I didn’t do the pictures.</p>
<h2 id="more-graphics">More graphics</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dwplot</span>(<span class="kw">list</span>(<span class="dt">additive=</span>lmTL1,<span class="dt">interaction=</span>lmTL2))+
<span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">0</span>,<span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="figure/dwplot_liz1-1.png" title="plot of chunk dwplot_liz1" alt="plot of chunk dwplot_liz1" style="display: block; margin: auto;" /></p>
<h2 id="effects-plot">Effects plot</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">allEffects</span>(lmTL2))</code></pre></div>
<p><img src="figure/unnamed-chunk-3-1.png" title="plot of chunk unnamed-chunk-3" alt="plot of chunk unnamed-chunk-3" style="display: block; margin: auto;" /></p>
<p>Session info:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.3.2 (2016-10-31)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 16.04.2 LTS
## 
## locale:
##  [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8    
##  [5] LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_CA.UTF-8   
##  [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] MASS_7.3-45      dplyr_0.5.0      tidyr_0.6.0      dotwhisker_0.2.3
##  [5] gtable_0.2.0     gridExtra_2.2.1  ggplot2_2.2.0    lsmeans_2.25    
##  [9] estimability_1.2 effects_3.1-2    knitr_1.15.1    
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.8      nloptr_1.0.4     plyr_1.8.4       highr_0.6       
##  [5] tools_3.3.2      digest_0.6.10    lme4_1.1-12      evaluate_0.10   
##  [9] tibble_1.2       nlme_3.1-129     lattice_0.20-34  psych_1.6.9     
## [13] Matrix_1.2-7.1   DBI_0.5-1        parallel_3.3.2   mvtnorm_1.0-5   
## [17] coda_0.19-1      stringr_1.1.0    nnet_7.3-12      R6_2.2.0        
## [21] survival_2.40-1  foreign_0.8-67   multcomp_1.4-6   TH.data_1.0-7   
## [25] minqa_1.2.4      reshape2_1.4.2   magrittr_1.5     scales_0.4.1    
## [29] codetools_0.2-15 splines_3.3.2    mnormt_1.5-5     assertthat_0.1  
## [33] colorspace_1.3-2 xtable_1.8-2     labeling_0.3     sandwich_2.3-4  
## [37] stringi_1.1.2    lazyeval_0.2.0   munsell_0.4.3    broom_0.4.1     
## [41] zoo_1.7-14</code></pre>
<p>Other refs - http://sas-and-r.blogspot.com/2010/10/example-89-contrasts.html - <a href="http://hosho.ees.hokudai.ac.jp/~kubo/Rdoc/library/gmodels/html/fit.contrast.html"><code>gmodels::fit.contrast()</code></a> (show parameter estimates based on re-fitting models with new contrasts), <a href="http://hosho.ees.hokudai.ac.jp/~kubo/Rdoc/library/rms/html/contrast.html"><code>rms::contrast.rms()</code></a> (ditto, for <code>rms</code>-based fits) - http://www.ats.ucla.edu/stat/r/library/contrast_coding.htm - Crawley <em>Statistical Computing: An Introduction to Data Analysis using S-PLUS</em>, chapter 18</p>
<div id="footer">
	<div style="text-align:center">
		<a href="index.html">Course home page</a>
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
		<a href="mailto:bio708qmee@gmail.com">Email the profs</a>
		&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
		<a href="logo.html">Logo information</a>
	</div>
</div>
</body>
</html>
